{% extends "base.html" %}
{% from "components/playlist_card.html" import playlist_card %}

{% block title %}PyJams - Collaborative Playlists{% endblock %}

{% block content %}
<div class="container py-4">
    <!-- Public Playlists Section -->
    <div class="row mb-4">
        <div class="col-12">
            <h2 class="text-light mb-3">Public Playlists</h2>
            {% if public_playlists %}
            <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
                {% for playlist in public_playlists %}
                <div class="col">
                    {{ playlist_card(playlist, is_manager=playlist.id in managed_playlist_ids) }}
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="card bg-dark text-light border-secondary">
                <div class="card-body text-center">
                    <p class="mb-0">No public playlists available yet.</p>
                    {% if request.session.get('admin') %}
                    <a href="{{ url_for('admin_panel') }}" class="btn btn-primary mt-2">Create Playlist</a>
                    {% endif %}
                </div>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Search Section -->
    <div class="row justify-content-center mb-4">
        <div class="col-md-8">
            <div class="card bg-dark text-light border-secondary">
                <div class="card-body">
                    <h5 class="card-title">Search Songs</h5>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-search"></i></span>
                        <input type="text" 
                               id="searchInput" 
                               class="form-control"
                               placeholder="Search for songs..." 
                               value="{{ query }}"
                               autocomplete="off">
                    </div>
                    <div id="searchResults" class="list-group mt-2" style="display: none;">
                        <!-- Search results will be inserted here -->
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% include "modals/playlist_manager.html" %}

<script>
document.addEventListener('DOMContentLoaded', function() {
    const playlistManagerForm = document.getElementById('playlistManagerForm');
    if (playlistManagerForm) {
        playlistManagerForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            try {
                const response = await fetch('/admin/add_manager', {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();
                if (response.ok) {
                    alert('Manager added successfully');
                    location.reload();
                } else {
                    alert(data.detail || 'Error adding manager');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error adding manager');
            }
        });
    }
});
</script>

{% endblock %}

{% block scripts %}
<script>
const searchUrl = "{{ url_for('search_tracks') }}";
const addSongUrl = "{{ url_for('add_song') }}";
const removeSongUrl = "{{ url_for('remove_song') }}";
const playlistStatsUrl = "{{ url_for('playlist_stats', playlist_id='PLAYLIST_ID') }}";
</script>
<script src="{{ url_for('js/search.js') }}"></script>
<script src="{{ url_for('js/main.js') }}"></script>
{% endblock %}
