{% extends "base.html" %}

{% block title %}PyJams - Collaborative Playlist{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{{ url_for('static', path='css/playlist.css') }}">
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Featured Playlist Section -->
    <section class="featured-playlist">
        <div class="row">
            <div class="col-lg-8">
                {% if settings.PUBLIC_PLAYLIST_ID %}
                <div class="playlist-embed-container">
                    <iframe src="https://open.spotify.com/embed/playlist/{{ settings.PUBLIC_PLAYLIST_ID }}?utm_source=generator&theme=0"
                            width="100%" 
                            height="352"
                            frameborder="0" 
                            allowfullscreen="" 
                            allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" 
                            loading="lazy">
                    </iframe>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="playlist-stats-card">
                    <h3 class="h5 mb-4">Playlist Statistics</h3>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <i class="fas fa-users"></i>
                            <span class="stat-value" id="followerCount">--</span>
                            <span class="stat-label">Followers</span>
                        </div>
                        <div class="stat-item">
                            <i class="fas fa-music"></i>
                            <span class="stat-value" id="trackCount">--</span>
                            <span class="stat-label">Tracks</span>
                        </div>
                        <div class="stat-item">
                            <i class="fas fa-clock"></i>
                            <span class="stat-value" id="totalDuration">--</span>
                            <span class="stat-label">Duration</span>
                        </div>
                    </div>
                </div>
                {% else %}
                <div class="no-playlist-alert">
                    <p>No public playlist has been set up yet.</p>
                    {% if request.session.get('admin') %}
                    <a href="{{ url_for('admin_panel') }}" class="btn btn-primary">Set up playlist</a>
                    {% endif %}
                </div>
                {% endif %}
            </div>
        </div>
    </section>

    <!-- Search Section -->
    <section class="search-section">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="search-container">
                    <div class="search-input-group">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" 
                               id="searchInput" 
                               placeholder="Search for songs to add..." 
                               value="{{ query }}"
                               autocomplete="off"
                               class="form-control search-input">
                    </div>
                    <div id="searchResults" class="search-results" style="display: none;">
                        <div class="results-loading" style="display: none;">
                            <i class="fas fa-spinner fa-spin"></i> Searching...
                        </div>
                        <div class="results-content"></div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- History & Stats Section -->
    <section class="history-stats-section">
        <div class="row g-4">
            <div class="col-md-6">
                <div class="stats-card">
                    <h4>Recent Activity</h4>
                    <div class="activity-placeholder">
                        <p>Recent additions and updates will appear here</p>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="stats-card">
                    <h4>Top Contributors</h4>
                    <div class="contributors-placeholder">
                        <p>Most active contributors will appear here</p>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>

<template id="track-card-template">
    <!-- ...existing code... -->
</template>
{% endblock %}

{% block scripts %}
<script>
// Only keep the URL configuration
const addSongUrl = "{{ url_for('add_song') }}";
const removeSongUrl = "{{ url_for('remove_song') }}";
</script>
<script src="{{ url_for('static', path='js/search.js') }}"></script>
{% endblock %}
