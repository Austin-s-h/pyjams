{% extends "base.html" %}

{% block title %}PyJams - Admin Panel{% endblock %}

{% block content %}
<div class="admin-container">
    <div class="section-header">
        <h1><i class="fas fa-shield-alt"></i> Admin Panel</h1>
    </div>
    
    {% if current_public_playlist %}
    <section class="current-public-section">
        <div class="section-header">
            <h2><i class="fas fa-star"></i> Current Public Playlist</h2>
        </div>
        <div class="playlist-card current-playlist">
            {% if current_public_playlist.images %}
            <img src="{{ current_public_playlist.images[0].url }}" alt="Playlist Cover" class="playlist-image">
            {% endif %}
            <div class="playlist-info">
                <h3>{{ current_public_playlist.name }}</h3>
                <p>{{ current_public_playlist.tracks.total }} tracks</p>
                <a href="{{ url_for('playlist_details', playlist_id=current_public_playlist.id) }}" 
                   class="view-playlist-btn">View Playlist</a>
            </div>
        </div>
    </section>
    {% endif %}

    <section class="select-playlist-section">
        <div class="section-header">
            <h2><i class="fas fa-list"></i> Select Public Playlist</h2>
        </div>
        <div class="playlist-grid">
            {% for playlist in playlists %}
            <div class="playlist-card {% if current_public_playlist and playlist.id == current_public_playlist.id %}current-playlist{% endif %}">
                <img src="{{ playlist.images[0].url if playlist.images else '/static/default-playlist.png' }}" 
                     class="playlist-image" 
                     alt="{{ playlist.name }}">
                <div class="playlist-info">
                    <h3 class="playlist-name">{{ playlist.name }}</h3>
                    <p class="playlist-tracks">{{ playlist.tracks.total }} tracks</p>
                    <button class="set-public-btn"
                            onclick="setPublicPlaylist('{{ playlist.id }}')"
                            {% if current_public_playlist and playlist.id == current_public_playlist.id %}disabled{% endif %}>
                        {% if current_public_playlist and playlist.id == current_public_playlist.id %}
                        Current Public Playlist
                        {% else %}
                        Set as Public Playlist
                        {% endif %}
                    </button>
                </div>
            </div>
            {% endfor %}
        </div>
    </section>
</div>
{% endblock %}

{% block scripts %}
<script>
    function setPublicPlaylist(playlistId) {
        if (!confirm('Are you sure you want to set this as the public playlist?')) return;

        fetch('/admin/set_public_playlist', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: `playlist_id=${playlistId}`
        })
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                alert(data.error);
            } else {
                alert(data.message);
                location.reload();
            }
        })
        .catch(error => {
            alert('Error setting public playlist');
        });
    }
</script>
{% endblock %}
