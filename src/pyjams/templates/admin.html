{% extends "base.html" %}

{% block title %}PyJams - Admin Panel{% endblock %}

{% block content %}
<div class="admin-container">
    <header class="admin-header">
        <h1><i class="fas fa-shield-alt"></i> Admin Panel</h1>
    </header>

    <div class="admin-layout">
        <!-- Sidebar with current playlist -->
        <aside class="admin-sidebar">
            <div class="current-playlist-widget">
                <h2>Public Playlist</h2>
                {% if current_public_playlist %}
                    <div class="current-playlist-info">
                        <img src="{{ current_public_playlist.images[0].url if current_public_playlist.images else '' }}" 
                             alt="Playlist cover"
                             class="playlist-thumbnail">
                        <div class="playlist-details">
                            <h3>{{ current_public_playlist.name }}</h3>
                            <p class="playlist-meta">
                                <span><i class="fas fa-music"></i> {{ current_public_playlist.tracks.total }} tracks</span>
                                <span><i class="fas fa-users"></i> {{ current_public_playlist.followers.total }} followers</span>
                            </p>
                        </div>
                        <div class="playlist-actions">
                            <a href="{{ url_for('playlist_details', playlist_id=current_public_playlist.id) }}" 
                               class="btn btn-secondary btn-sm">
                                <i class="fas fa-external-link-alt"></i> View
                            </a>
                        </div>
                    </div>
                {% else %}
                    <div class="empty-state">
                        <i class="fas fa-music"></i>
                        <p>No public playlist set</p>
                    </div>
                {% endif %}
            </div>
        </aside>

        <!-- Main content area -->
        <main class="admin-main">
            <div class="playlist-grid">
                <h2>Your Playlists</h2>
                <div class="playlist-cards">
                    {% for playlist in playlists %}
                        <div class="playlist-card {{ 'is-current' if playlist.id == settings.PUBLIC_PLAYLIST_ID }}">
                            <img src="{{ playlist.images[0].url if playlist.images else '' }}" 
                                 alt="{{ playlist.name }}"
                                 class="playlist-cover">
                            <div class="playlist-info">
                                <h3>{{ playlist.name }}</h3>
                                <p>{{ playlist.tracks.total }} tracks</p>
                            </div>
                            <div class="card-actions">
                                {% if playlist.id != settings.PUBLIC_PLAYLIST_ID %}
                                    <form action="{{ url_for('set_public_playlist') }}" method="POST" onsubmit="event.preventDefault(); setPublicPlaylist('{{ playlist.id }}');">
                                        <input type="hidden" name="playlist_id" value="{{ playlist.id }}">
                                        <button type="submit" class="btn btn-primary btn-sm">Set Public</button>
                                    </form>
                                {% else %}
                                    <span class="status-badge">Current Public</span>
                                {% endif %}
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </main>
    </div>
</div>

<div id="notification" class="notification" style="display: none;">
    <span id="notification-message"></span>
    <button onclick="hideNotification()" class="close-btn">&times;</button>
</div>

{% endblock %}

{% block scripts %}
<script>
function setPublicPlaylist(playlistId) {
    fetch('/admin/set_public_playlist', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: `playlist_id=${playlistId}`
    })
    .then(response => response.json())
    .then(data => {
        if (data.error) {
            showNotification(data.error, 'error');
        } else {
            showNotification(data.message, 'success');
            // Optional: Refresh the page after a short delay
            setTimeout(() => window.location.reload(), 2000);
        }
    })
    .catch(error => {
        showNotification('Error setting public playlist', 'error');
    });
}

function showNotification(message, type = 'success') {
    const notification = document.getElementById('notification');
    const messageElement = document.getElementById('notification-message');
    
    notification.className = `notification ${type}`;
    messageElement.textContent = message;
    notification.style.display = 'flex';
    
    // Auto-hide after 5 seconds
    setTimeout(hideNotification, 5000);
}

function hideNotification() {
    document.getElementById('notification').style.display = 'none';
}
</script>
{% endblock %}
